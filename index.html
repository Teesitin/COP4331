<!DOCTYPE html>
<html lang="en">
<head>
    <!-- Meta Tags -->
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    
    <!-- Title and Favicon -->
    <title>User Database</title>
    <link rel="icon" type="image/webp" href="../assets/branding2/co-white-fav.webp">

    <!-- Google Fonts and Icons -->
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@300;400;500&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@20..48,100..700,0..1,-50..200">
    <script type="text/javascript" src="//translate.google.com/translate_a/element.js?cb=googleTranslateElementInit"></script>

    <!-- CSS -->
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <div class="main-container">
        <!-- Logo -->
        <img class="logo" id="logo" src="../assets/branding2/co-color-rectangle.webp">

        <!-- Controls Container -->
        <div class="controls-container">
            <button class="control-button" onclick="window.location.href='/add-user';">
                <span class="material-symbols-outlined">person_add</span>
            </button>

            <!-- Search -->
            <input class="contacts-search-bar" type="text" placeholder="Search User" onkeyup="filterProfiles()">
        </div>

        <!-- Profiles -->
        <div id="profile-container" class="profile-container"></div>
    </div>

    <!-- Menu Button -->
    <button id="menuButton" class="menu-button notranslate">
        <span class="material-symbols-outlined">more_horiz</span>
    </button>

    <!-- Menu  -->
    <div id="menuModal" class="menu-modal">
        <div class="menu-container">
            <div class="menu-content">
                <div>
                    <span>Theme</span>
                    <div class="menu-content-button">
                        <button id="themeLight" onclick="switchTheme(0)">Online Day</button>
                        <button id="themeLight" onclick="switchTheme(1)">Online Night</button>
                        <button id="themeLight" onclick="switchTheme(2)">Dual Hue</button>
                        <button id="themeLight" onclick="switchTheme(3)">High Contrast</button>
                    </div>
                </div>
                <div>
                    <span>Accessibility</span>
                    <div class="menu-content-button">
                        <button onclick="toggleAccessibility(true)">On</button>
                        <button onclick="toggleAccessibility(false)">Off</button>
                    </div>
                </div>
                <div>
                    <span>Language</span>
                    <div class="menu-content-button">
                        <div id="google_translate_element"></div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Delete Menu -->
    <div id="deleteConfirmationModal" class="menu-modal">
        <div class="menu-container-delete">
            <div class="menu-content-delete" style="text-align: center;">
                <span>Are you sure you want to delete
                    <span id="userNameToDelete"></span>?
                </span>
                <button onclick="confirmDelete()">Delete User</button>
                <button onclick="closeDeleteConfirmationModal()">Cancel</button>
            </div>
        </div>
    </div>




    <!-- JS -->
    <script>
        // General
        const root = document.documentElement;

        function googleTranslateElementInit() {
            new google.translate.TranslateElement({pageLanguage: 'en'}, 'google_translate_element');
        }

        // Menu Modal
        var menuButton = document.getElementById('menuButton');
        var menuModal = document.getElementById('menuModal');
        var menuOpened = false;

        menuButton.addEventListener('click', function() {
            if (menuOpened) {
                menuModal.style.animation = "menu-animate-out 0.5s";
                setTimeout(function() {
                    menuModal.style.display = "none";
                }, 490);
                document.body.style.overflow = "auto";
                menuOpened = !menuOpened;
            } else {
                menuModal.style.display = "block";
                menuModal.style.animation = "menu-animate-in 0.5s";
                menuOpened = !menuOpened;
                document.body.style.overflow = "hidden";
            }
        });


        // Delete Modal Animation Logic
        var deleteModalOpened = false;
        var deleteModal = document.getElementById('deleteConfirmationModal');

        function openDeleteConfirmationModal(userId, userName) {
            userIdToDelete = userId;  // Store the user ID

            document.getElementById('userNameToDelete').innerText = userName;


            if (!deleteModalOpened) {
                deleteModal.style.display = "block";
                deleteModal.style.animation = "menu-animate-in 0.5s";
                deleteModalOpened = !deleteModalOpened;
                document.body.style.overflow = "hidden";
            }
        }

        function closeDeleteConfirmationModal() {
            if (deleteModalOpened) {
                deleteModal.style.animation = "menu-animate-out 0.5s";
                setTimeout(function() {
                    deleteModal.style.display = "none";
                }, 490);
                document.body.style.overflow = "auto";
                deleteModalOpened = !deleteModalOpened;
            }
        }

        function confirmDelete() {
            // Your delete logic here
            closeDeleteConfirmationModal();
        }



    // Theme
        //Get Theme
        let themeArray = [];

        fetch('../data/theme.json')
            .then(response => {
                if (!response.ok) {
                    throw new Error('Network response was not ok ' + response.statusText);
                }
                return response.json();
            })
            .then(data => {
                themeArray = data;
            })
            .catch(error => {
                console.error('There has been a problem with your fetch operation:', error);
            });

        // Check Theme
        function checkAndSwitchTheme() {
            const savedThemeID = localStorage.getItem('themeID');

            if(savedThemeID !== null) {
                switchTheme(savedThemeID);
            } 
            else {
                localStorage.setItem('themeID', 0);
            }
        }

    
        
        // Set Theme
        var logo = document.getElementById('logo');

        function switchTheme(themeID) {
            var theme = themeArray[themeID];
            localStorage.setItem('themeID', themeID);
            console.log(theme);

            root.style.setProperty('--background', theme['background']);
            root.style.setProperty('--containers', theme['containers']);
            root.style.setProperty('--container-border', theme['container-border']);
            root.style.setProperty('--text', theme['text']);
            root.style.setProperty('--buttons', theme['buttons']);
            root.style.setProperty('--button-border', theme['button-border']);
            root.style.setProperty('--button-text', theme['button-text']);

            logo.src = '../assets/branding2/' + theme['logo'];
        }

    // Accessibility
        function toggleAccessibility(enable) {
            if (enable) {
                root.style.setProperty('--global-font-size', '1.3rem');
                root.style.setProperty('--button-font-size', '1.306rem');
                root.style.setProperty('--profile-box-width', '480px');
                localStorage.setItem('accessibility', true);
            } else {
                root.style.setProperty('--global-font-size', '1rem');
                root.style.setProperty('--button-font-size', '1.02rem');
                root.style.setProperty('--profile-box-width', '300px');
                localStorage.setItem('accessibility', false);
            }
        }

        // Check Accessibility
        function checkAndSwitchAccessibility() {
            const savedAccessibility = localStorage.getItem('accessibility');

            if(savedAccessibility !== null) {
                toggleAccessibility(savedAccessibility === "true"); 
            } 
            else {
                localStorage.setItem('accessibility', false);
            }
        }



    //People    
        // Get People
        let peopleData = [];

        fetch('../data/people.json')
            .then(response => {
                if (!response.ok) {
                    throw new Error('Network response was not ok ' + response.statusText);
                }
                return response.json();
            })
            .then(data => {
                peopleData = data;
                displayProfiles(peopleData); // Initial display of profiles
            })
            .catch(error => {
                console.error('There has been a problem with your fetch operation:', error);
            });



        // Filter People
        function filterProfiles() {
            const searchInput = document.querySelector('.contacts-search-bar').value.toLowerCase();
            const filteredProfiles = peopleData.filter(person => {
                return person.firstName.toLowerCase().startsWith(searchInput) || person.lastName.toLowerCase().startsWith(searchInput);
            });
            displayProfiles(filteredProfiles);
        }



        // Display People
        function displayProfiles(profiles) {
            const profileContainer = document.getElementById('profile-container');

            let profilesHTML = '';
            profiles.forEach(person => {
                profilesHTML += `
                    <div class="profile-box">
                        <img class="profile-image" 
                            src="../assets/headshots/hs-${person.id}.webp" 
                            alt="${person.firstName}"
                            onerror="this.onerror=null; this.src='../assets/100.webp';">
                        <div class="profile-details">
                            <h3 id="name-${person.id}">${person.firstName} ${person.lastName}</h3>
                            <p id="email-${person.id}"><a href="mailto:${person.email}">${person.email}</a></p>
                            <p id="phone-${person.id}"><a href="tel:${person.phone}">${person.phone}</a></p>
                            <div class="user-control-container">
                                <button class="user-control-button"><span class="material-symbols-outlined">call</span></button>
                                <button class="user-control-button" onclick="window.location.href='/modify-user?userID=${person.id}';"><span class="material-symbols-outlined">edit</span></button>
                                <button class="user-control-button" onclick="openDeleteConfirmationModal(${person.id}, '${person.firstName} ${person.lastName}')"><span class="material-symbols-outlined">person_remove</span></button>
                            </div>
                        </div>
                    </div>
                `;
            });

            profileContainer.innerHTML = profilesHTML;
        }


        //Wait for Full Dom
        window.onload = function() {
            checkAndSwitchTheme();
            checkAndSwitchAccessibility();
        }
        
    </script>
</body>
</html>